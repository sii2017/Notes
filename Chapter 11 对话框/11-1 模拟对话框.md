# 第十一章 对话框
如果有很多输入超出了菜单可以处理的程度，那么我们可以使用对话框来取得输入信息。程序写作者可以通过在某选项后面加上省略号（…）来表示该菜单项将启动一个对话框。  
对话框的一般形式是包含多种子窗口控件的弹出式窗口，这些控件的大小和位置在程序资源描述文件的「对话框模板」中指定。  
当我们的程序调用模板建立的对话框时，操作熊会建立弹出式对话框窗口和子窗口控件，并（负责处理）提供处理对话框消息（包括所有键盘和鼠标输入）的窗口消息处理程序。有时候称呼完成这些功能的Windows内部程序代码为「对话框管理器」。　　
Windows的内部对话框窗口消息处理程序所处理的许多消息也传递给我们自己程序中的函数。　　
当我们在对话框中使用子窗口控件时，第九章所提到的许多工作都可以由Windows的对话框管理器来完成。比如焦点的切换等等。
## 模拟对话框
对话框分为两类：「模态的」（模板的）和「非模态的」，其中模态对话框最为普遍。　　
当程序显示一个模态对话框时，使用者不能在对话框与同一个程序中的另一个窗口之间进行切换，必须点OK或者取消后才能切换到程序中的其他部分。不过通常可以从目前的程序切换到另一个程序。
### 建立About对话框
参考ABOUT1.C   
该程序与之前的基本程序大致相同，只是在程序中创建**ID为AboutBox**的对话框（首次）,与MessageBox非常相似。唯一不同的是，MessageBox的**第二个参数仅仅为标题**，并且对话框有自己专用的消息处理程序。  
### 对话框及其模板
Developer Studio将对话框的ID设为标准的IDD_DIALOG1。对此我们可以修改该ID成AboutBox（带引号）来适配我们的代码调用。X Pos和Y Pos字段改为32。（这将表示对话框的显示位置）  
这些坐标和大小的单位都不是图素。它们实际上依据一种特殊的坐标系统，**该系统只用于对话框模板**。   
模板中的STYLE叙述类似于CreateWindow呼叫中的style字段。对于模态对话框，通常使用WS_POPUP和DS_MODALFRAME，我们将在稍后介绍其它的选项。   
在上一个程序中，我们在对话框内使用了三种形态的子窗口控件，分别是DEFPUSHBUTTON（内定按键）、ICON（图标）和CTEXT（文字居中），他们的格式为：   
control-type "text" id, xPos, yPos, xWidth, yHeight, iStyle  
这些子控件的**id字段**是子窗口在向其父窗口发送消息（通常为WM_COMMMAND消息）时用来标示它自身的值。**这些子窗口控件的父窗口就是对话框本身**，它将这些消息发送给Windows的一个窗口消息处理程序。   
由于文字和图标控件不向父窗口回送消息（只负责显示），所以这些值被设定为IDC_STATIC，它在RESOURCE.H中定义为-1（所有不需要相应的控件的ID的默认值）。按键的ID值为IDOK，它在WINUSER.H中定义为1。
### 对话框程序
我们程序里的对话框的窗口消息处理程序，并不是真实的窗口消息处理程序。对话框的窗口消息处理程序定义在Windows内部。    
```c
BOOL CALLBACK AboutDlgProc (HWND hDlg, UINT message,WPARAM wParam, LPARAM lParam)  
{  
	switch(message)    
	{   
	case WM_INITDIALOG:    
		return TRUE;   
	case WM_COMMAND:    
		switch(LOWORD(wParam))   
		{   
		case IDOK:    
		case IDCANCEL:   
			EndDialog(hDlg, 0);   
			return TRUE;     
		}   
		break;    
	}    
	return FLASE;    
}   
```  
该函数的参数与常规窗口消息处理程序的参数相同，与窗口消息处理程序类似，对话框程序都必须定义为一个CALLBACK（callback）函数。这个函数与窗口消息处理程序的区别为：   
> 窗口消息处理程序传回一个LRESULT。对话框传回一个BOOL，它在Windows表头文件中定义为int型态。    
> 如果窗口消息处理程序不处理某个特定的消息，那么它将呼叫DefWindowProc。如果对话框程序处理一个消息，传回TRUE让DefWindowProc忽略它；如果不处理，则传回FALSE（0）让DefWindowProc处理。    
> 对话框程序不需要处理WM_PAINT或WM_DESTROY消息。对话框程序不接收WM_CREAT消息，而是在特殊的WM_INITDIALOG消息处理期间，对话框程序执行初始化操作。     

WM_INITDIALOG消息是对话框接收到的第一个消息，这个消息只发送给对话框程序。**1）如果处理这个消息并且返回TRUE，那么windows将自动把输入焦点设定给对话框中第一个具有WS_TABSTOP样式的子窗口控件（按键）。2）也可以在处理WM_INITDIALOG时使用SetFocus来自定义输入焦点，但是需要传回FALSE。**     
此外，对话框程序只处理WM_COMMAND消息，即对话框中的子控件被点击或空格时发给父窗口的消息。控件的ID在wParam的低字节中。同样，如果处理则返回TRUE，如果不处理则返回FALSE让DefWindowProc处理。   
模态对话框的消息不通过您程序的消息队列，所以不必担心对话框中键盘快捷键的影响。（猜测对话框的消息应该是作为COMMAND发给父窗口的）。
### 激活对话框
### 不同的主题
### 更复杂的对话框
参考ABOUT2.C  
### 使用对话框控件
### OK和Cancel按钮
### 避免使用整体变量
### Tab停留和分组
### 在对话框上画图
### 将其它函数用于对话框
### 定义自己的控件
参考ABOUT3.C