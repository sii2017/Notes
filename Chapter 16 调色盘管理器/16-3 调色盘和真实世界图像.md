## 调色盘和真实世界图像
调色盘管理器的真正目的是允许在8位显示模式下显示真实世界中的图像。（现在已经不再需要在8位显示模式下显示图像了，调色板似乎已经不再被需要了）   
**在使用packed DIB、GDI位图对象和DIB区块时，必须按照不同的方法来使用调色盘。下面的六个程序阐明了用调色盘来处理位图的各种技术**。
### 调色盘和Packed DIB
以下三个程序，将建立用来处理Packed DIB内存块的一系列函数。这些函数都在程序PACKEDIB文件中。   
**参考PACKEDIB.H PACKEDIB.C**  
以上代码中是用来操作packed DIB的一些函数，并且从中获得一些数据。  
这种函数包括太多的巢状函数呼叫，以致于效率非常低而且很慢。本章的后面将讨论一种我认为更好的方法。   
另外，其中许多函数都需要对OS/2兼容的DIB采取不同的处理程序；这样，函数将频繁地检查BITMAPINFO结构的第一个字段是否与BITMAPCOREHEADER结构的大小相同。  
特别注意最后一个函数PackedDibCreatePalette。这个函数用DIB中的颜色表来建立调色盘。如果DIB中没有颜色表（这意味着DIB的每图素有16、24或32位不需要调色盘，用的是系统调色盘），那么就不建立调色盘。我们有时会将从DIB颜色表建立的调色盘称为DIB 自己的调色盘。   
参考SHOWDIB3.C   
使用PACKEDIB.C.H来获取DIB信息，并且绘图。   
如果是8位就建立逻辑绘图板并且显现，不然则不。（按书上说会按照20标准色来显现，但是现在的显卡都是真彩色，如果默认显现的话可能是32位真彩色？）   
由于8位位图已经不使用了，甚至画图软件都不能以这个规格保存，无法测试。  
### 通用调色盘
**程序SHOWDIB4程序建立了一个通用的调色盘，它用于显示加载到程序中的所有DIB。**另外，SHOWDIB4与SHOWDIB3非常相似。  
参考SHOWDIB4.C  
SHOWDIB3和SHOWDIB4不同的地方在于，SHOWDIB3根据DIB是不是8位位图，来判断是否建立调色盘，而SHOWDIB4则不管是什么位图，都将建立（通用）调色盘。   
在处理WM_CREATE消息时，SHOWDIB4将呼叫CreateAllPurposePalette，并在程序中保留该调色盘，而在WM_DESTROY消息处理期间删除它。因为程序知道调色盘一定存在，所以在处理WM_PAINT、WM_QUERYNEWPALETTE或WM_PALETTECHANGED消息时，不必检查调色盘的存在。   
CreateAllPurposePalette函数似乎是用247个项目来建立逻辑调色盘，它超出了系统调色盘中允许程序正常存取的236个项目。的确如此，不过这样做很方便。这些项目中有15个被复制或者映射到20种标准的保留颜色中。（根据之前了解的，如果逻辑调色盘的数量超出系统调色盘中允许存取的数量，多余的颜色将被映射到与其相似的20种标准保留颜色中）    
显然地，实际的程序并没有计算16位、24位或者32位DIB的最佳调色盘，程序将持续使用DIB颜色表来显示8位DIB。SHOWDIB4不完成这项工作，它只对每件事都使用通用调色盘。对于一些彩色DIB，SHOWDIB4（中用来支持8位位图的247个颜色的调色盘）可能并没有足够的颜色来精确地表示鲜艳的色调。  
### 中间色调色盘
Windows API有一个通用调色盘，可以通过调用CreateHalftonePalette来获得该调色盘。  
使用此调色盘的方法与使用从SHOWDIB4中的CreateAllPurposePalette获得调色盘的方法相同，或者也可以与位图缩放模式中的HALFTONE设定－用SetStretchBltMode设定－一起使用。  
**程序SHOWDIB5程序展示了使用中间色调色盘的方法。**   
参考SHOWDIB5.C   
SHOWDIB5程序类似于SHOWDIB4，SHOWDIB4中不使用DIB中的颜色表，而使用适用于图像范围更大的调色盘。为此，SHOWDIB5使用了由Windows支持的逻辑调色盘，其句柄可以从CreateHalftonePalette函数获得。   
中间色调色盘并不比SHOWDIB4中的CreateAllPurposePalette函数所建立的调色盘更复杂，并且结果是相似的。但是如果调用下面两个函数：   
```c
SetStretchBltMode (hdc, HALFTONE) ;   
SetBrushOrgEx (hdc, x, y, NULL) ;   
```
其中，x和y是DIB左上角的设备坐标，并且如果用StretchDIBits而不是SetDIBitsToDevice来显示DIB，那么结果是：**颜色色调要比不设定位图缩放模式来使用CreateAllPurposePalette或者CreateHalftonePalette更精确。**Windows使用一种混色图案来处理中间色调色盘上的颜色，以使其更接近8位显示卡上原始图像的颜色。不过，这样做将需要更多的处理时间。   
### 索引调色盘颜色

参考SHOWDIB6.C
### 调色盘和位图对象
参考SHOWDIB7.C
### 调色盘和DIB区块
参考SHOWDIB8.C