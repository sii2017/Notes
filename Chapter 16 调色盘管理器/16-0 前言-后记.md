## 前言
颜色调色板是一种机制，通过它**可以显示很宽范围的颜色而不需要使用大量的空间**。  
调色板显示方式只有每种像素4位和8位颜色深度两种，其中4位颜色深度已经不使用，我们只讨论每种像素8位的颜色深度。在这种色深下，每个像素可赋予一个从0到255的值，这个值充当一个索引，以访问有256个条目的数组，该数组即所谓的颜色调色板。在该数组中的每个条目，包含一个8位值以对应一种颜色的红、绿、蓝颜色强度。在效果上，这使每像素8位的色深可访问16777216种可能的颜色，**但只能同时显示其中的256种**。在显示位图的时候，视频硬解查看8位颜色值，运用该值作为索引访问256条目的颜色表。用指明的颜色表条目所存储的红、绿、蓝强度绘制像素。   
用每像素8位的颜色模式工作，有一个主要缺点是：**同时显示的所有位图必须用同一个调色板画出**。而用一个调色板画的位图在另一个使用其他调色板的设备上显示，会产生意想不到的结果（**不同设备上的调色板颜色，未必是一样的，颜色多达16777216但是只能同时显示256种**）。位图上的像素可以在当前景调色板上用最佳近似的适当颜色绘制出来，但这个过程很慢而且总会产生不合适的结果。可以对不同场景使用不同调色板，不过这也会降低效果。       
windows 所使用的调色板有两个不同种类：**系统调色板和逻辑调色板**。  
1 **系统调色板**是windows保留的全球通用调色板，包括一切可以显示的颜色。开头和末尾各有10个调色板条目为系统保留，包括20个用于绘制特殊用户界面元素的静态颜色，如windows标题栏、边界、三围用户界面元素。其余236个颜色可由程序设定。   
2 **逻辑调色板是由程序产生的，包含程序需要的颜色。当程序设置了它想要的颜色，windows调色板管理器将对逻辑调色板与当前的系统调色板进行合并，这是通过检查逻辑调色板每个条目，把它在已有系统调色板的条目上画出而实现的。如果一个颜色在两个调色板上都有这么做，如果没有找到匹配条目，就把逻辑调色板中的颜色放进系统调色板的第一个未经使用的条目。如果没有找到现成条目而且再没有未经使用的调色板条目，windows调色板管理器就用系统调色板中最近似的颜色来画。这个过程一直持续直到逻辑调色板与系统调色板中所有颜色合并为止。**   
在使用之前，必须把逻辑调色板选进设备环境(DC)。如果规定的设备环境认同一个激活的窗口，就把逻辑调色板当做前景调色板，windows调色板管理器将把系统调色板中所有非静态条目标注为未使用。这使逻辑调色板有潜力（可以）取代系统调色板中的非静态颜色。如果设备环境不认可激活的窗口，逻辑调色板就被当做背景调色板，只有在前景调色板合并后有剩余才能设置未经使用的调色板条目。   
注意：   
以前Windows只有16色或者256色的时候，系统有逻辑调色板和系统调色板，调色板存储了RGB表示的n种颜色，可以指定给画笔来绘图，功能和BMP里的色彩表是对应的。现在Windows的显示模式都是32位真彩色的，调色板已经没有用处，位图直接存储的是RGB值。   
以前的Windows绘图必须先把想要的颜色设置进调色板，现在不用了。调色板可以用来实现一些简单的动画。
## 后记
由于最后一章的代码量实在是太大，且由于过时收益不高，因此停止，并对之前的内容以及现在的技术做一个简单的总结。   
调色盘如今已经不再经常使用，现在的显卡至少为24位，大多数为32位真彩色。在显示图像的时候不用调用调色盘，而是直接显示。  
通过代码做一些演示来表达以前和现在的区别：  
1 从前由于硬件不支持以及位图为8位，所以需要获取/创建/显现调色盘：  
```c
//将位图做成packed DIB，并且从中获取位图
hPalette= CreateAllPurposePalette();//获取/创建调色盘   
SelectPalette(hdc, hPalette, FALSE);//将调色盘选入设备内容
RealizePalette(hdc);//显现调色盘（将逻辑调色盘合并到系统调色盘）   
SetDIBitsToDevice(参数);//显示画面    
```  
2 现在硬件允许了，所以可以直接读取DIB，并且不需要调色盘进行显示：  
```c
hBitmap = LoadBitmap(hInstance, MAKEINTRESOURCE(IDB_BITMAP1));   //直接读取位图到到内存中   
GetObject(hBitmap, sizeof(BITMAP), &bitmap);    
hdcMem = CreateCompatibleDC(hdc);//创建一个兼容于hdc设备环境描述表的hdcMem  主要是用于在内存中截图     
SelectObject(hdcMem, hBitmap);   //将位图选到hdcMem中   
BitBlt(hdc, -1, -1, cxBitmap, cyBitmap, hdcMem, 0, 0, SRCCOPY);//绘制bmp位图    
```
另外本章的附件内容将对当前学过的四个显示位图的函数做个总结。