## 调色盘动画
我们可以使用windows调色盘管理器做一些动画。   
通常，Windows下的动画就是快速连续地显示一系列位图。调色盘动画与这种方法有很大的区别。我们透过在屏幕上绘制您所需要的每件东西开始，然后您处理调色盘来改变这些对象的颜色，画**一些相对于屏幕背景来说是不可见的图像**。您用这种方法就可以获得动画效果，而**不必重画任何东西**。调色盘动画的速度是相当快的。   
对于调色盘动画，最初的建立工作与我们之前做的有些不同：对于动画期间要修改的每种RGB颜色值，**PALETTEENTRY结构的peFlags字段必须设定为PC_RESERVED**。   
通常在建立逻辑调色盘时，我们将peFlags标记设为0。这允许GDI将多个逻辑调色盘中同样的颜色映像到相同的系统调色盘项目。  
例如，假设两个Windows程序都建立了包含RGB项目10-10-10的逻辑调色盘，那么在系统调色盘表中，Windows只需要一个10-10-10项目。   
但如果这两个程序中的一个使用调色盘动画，那在程序中最好不要让GDI使用调色盘了。调色盘动画本身速度非常快－并且如果它不重画（GDI的重画）那么它将更快。当程序使用调色盘动画修改调色盘时，它不会影响其它程序使用调色盘，也不会迫使GDI重组系统调色盘表。PC_RESERVED的peFlags值为单个逻辑调色盘储存系统调色盘项目（这段意义不是很明白，但是总而言之，这个flag是为调色盘动画准备的）。   
使用调色盘动画时，通常可以在WM_PAINT消息处理期间调用SelectPalette和RealizePalette，**使用PALETTEINDEX宏来指定颜色**。该宏将一个索引带进逻辑调色盘表。  
对于动画，需要通过改变调色盘来响应WM_TIMER消息。要改变逻辑调色盘中的RGB颜色值，要使用一个PALETTEENTRY结构的数组来呼叫函数AnimatePalette。**此函数速度很快，因为它只需要改变系统调色盘以及显示卡硬件调色盘表中的项目**。
### 跳动的球
以下程序显示了BOUNCE程序的组件，但还有一个程序可显示跳动的球。为了简单起见，根据显示区域的大小将球画成了椭圆形。因为本章有几个调色盘动画程序，所以PALANIM.C（「调色盘动画」）文件包含一些通用内容。  
参考PALANIM.C
参考BOUNCE.C   
除非Windows处于支持调色盘的显示模式下，否则调色盘动画将不能工作。因此，PALANIM.C通过呼叫CheckDisplay函数（与SYSPAL程序中的函数相同）来开始处理WM_CREATE。   
**所以尽管我注释了CheckDisplay函数，我的小球依旧不能动。**  
**由于现在的显卡已经不再使用调色盘的显示模式了，使用的是显卡上的真彩32位，所以这一章的内容到此为止。**  
P927
### 一个项目的调色盘动画
参考FADER.C
参考ALLCOLOR.C
### 工程应用程序
参考PIPES.C
参考TUNNEL.C