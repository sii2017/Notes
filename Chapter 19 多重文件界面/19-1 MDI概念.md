# 第十九章 多重文件界面
## MDI概念
MDI多重文件界面在windows2.0已经普及，但是当时写起来比较困难。  
从windows3起，其中许多工作已经由windows做好了。并且windows95中增强的支持也加入了进来。   
### MDI的组成
MDI程序的主应用程序窗口是很普通的：它有一个标题列、一个菜单、一个缩放边框、一个系统菜单图标和最大化/最小化/关闭按钮。显示区域经常被称为「工作空间」，它不直接用于显示程序输出。这个工作空间包括零个或多个子窗口，每个窗口都显示一个文件。   
这些子窗口看起来与通常的应用程序窗口以及MDI程序的主窗口很相似。它们有一个标题列、一个缩放边框、一个系统菜单图标和最大化/最小化/关闭按钮，可能还包括滚动条。但是文件窗口没有菜单，主应用程序窗口上的菜单适用于文件窗口。   
**在任何时候都只能有一个文件窗口是活动的（加亮标题列来表示）**，它出现在其它所有文件窗口之前。所有文件窗口都由工作空间区域加以剪裁，而不会出现在应用程序窗口之外。   
初看起来，对Windows程序写作者来说，MDI似乎是相当简单。需要程序写作者做的工作好像就是为每个文件建立一个WS_CHILD窗口，并使程序的主应用程序窗口成为文件窗口的父窗口。但对现有的MDI应用程序稍加研究，就会发现一些复杂问题。例如（包括不限于）：   
1 **MDI文件窗口可以最小化。**它的图示出现在工作空间的底部。一般来说，MDI应用程序可以将不同的图示分别用于主应用程序窗口和每一类文件应用。
MDI文件窗口可以最大化。在这种情况下，文件窗口的标题列（一般用来显示窗口中文件的文件名称）消失，文件名称出现在应用程序窗口标题列的应用程序名称之后，文件窗口的系统菜单图标成为应用程序窗口的顶层菜单中的第一项。关闭文件窗口按钮变成顶层菜单中的最后一项，且出现在最右边。   
2 **用以关闭文件窗口的系统键盘快捷键与关闭主窗口的系统键盘快捷键一样，只是Ctrl键代替了Alt键。**这也就是说，Alt+F4用于关闭应用程序窗口，而Ctrl+F4用于关闭文件窗口。此外，Ctrl+F6可以在活动MDI应用程序的子文件窗口之间切换。与平时一样，Alt+空格键启动主窗口的系统菜单，Alt+-（减号）启动活动子文件窗口的系统菜单。   
3 **当使用光标键在菜单项间移动时，控件权通常从系统菜单转到菜单列中的第一项。**在MDI应用程序中，控件权是从应用程序系统菜单转到活动文件系统菜单，然后再转到菜单列中的第一项。   
4 如**果应用程序能够支持若干种型态的子窗口（如Microsoft Excel中的工作表和图表文件），那么菜单应能反映出与这种型态的文件有关的操作。这就要求当不同的文字窗口变成活动窗口时，程序能更换菜单。**此外，当没有文件窗口存在时，菜单应该被缩减到只剩下与打开新文件有关的操作。   
5 **顶层菜单上有一个叫做「窗口（Window）」的菜单项。**按照习惯，这是顶层菜单上「Help」之前的那一项，即倒数第二项。「窗口」子菜单上通常包含在工作空间内安排文件窗口的选项。文件窗口可以从左上方开始「平铺」或「层迭」。在前一种方式下，可以完整地看到每一个文件窗口。这个子菜单同时也包含所有文件窗口的列表。从中选择一个文件窗口，就可以把此文件窗口移到前景。   
Windows 98支持MDI的所有这些方面。当然，需要您做一些工作（如下面的范例程序所示），但是，这远不需要直接写作来直接支持所有这些功能。
### MDI支援
探讨Windows的MDI支持时需要发表一些新术语。   
主应用程序窗口称为「**框架窗口**」，就像传统的Windows程序一样，它是WS_OVERLAPPEDWINDOW样式的窗口。    
MDI应用程序还根据预先定义的窗口类别MDICLIENT建立「**客户窗口**」，这一客户窗口是用这种窗口类别和WS_CHILD样式呼叫CreateWindow来建立的。这一呼叫的最后一个参数是指向一个CLIENTCREATESTRUCT型态的结构的指针。这个客户窗口覆盖框架窗口的显示区域，并提供许多MDI支持。此客户窗口的颜色是系统颜色COLOR_APPWORKSPACE。   
文件窗口被称为「**子窗口**」。通过初始化一个MDICREATESTRUCT型态的结构，以一个指向此结构的指针为参数将消息WM_MDICREATE发送给客户窗口，就可以建立这些文件窗口。   
文件窗口是客户窗口的子窗口，而客户窗口又是框架窗口的子窗口。   
