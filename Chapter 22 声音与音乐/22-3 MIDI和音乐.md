## 本章注释
这里提到了MIDI编曲技术，这可能是我职业生涯中都用不到的一种技术，因此暂时跳过。    
## MIDI和音乐
由电子音乐合成器制造者协会在19世纪80年代早期开发了「乐器数字化接口」（MIDI：Musical Instrument Digital Interface）。MIDI是用于将它们中的电子乐器与计算机连结起来的协议，也是电子音乐领域中相当重要的标准。MIDI规范由MIDI Manufacturers Association（MMA）维护，它的网站是http://www.midi.org。    
### 使用MIDI（简介MIDI控制器）
MIDI为透过电缆来传递数字命令定义了传输协议。MIDI电缆使用5针DIN接头，但是只使用了三个接头。一个是屏蔽，一个是回路，而第三个传输数据。MIDI协议在每秒31,250位（约3.8M）的速度下是单向的。**数据的每个字节都由一个开始位开始，以一个停止位结束**，用于每秒3,125字节的有效传输速率。     
然而真实的声音（不论是模拟格式还是数字格式），并不是经由MIDI电缆传输的。通过电缆传输的通常都是简单的命令消息，长度一般是1、2或3字节。   
简单的MIDI设定可以包括两片MIDI兼容硬件。一个是本身不发声，但是单独产生MIDI消息的MIDI键盘。此键盘有一个有标记有「MIDI Out」的MIDI端口。用MIDI电缆将这个埠与MIDI声音合成器的「MIDI In」埠连结起来。合成器看起来很像前面有几个按钮的小盒子。    
按下键盘上的一个键时（假定是中音C），键盘就将3个字节发送给MIDI Out端口。在十六进制中，这些字节是：    
90 3C 40    
**第一个字节（90）显示Note On消息**。第二个字节是键号，其中3C是中音C。第三个字节是敲按键的速度，此速度范围是从1到127。我们恰巧使用了一个对速度不敏感的键盘，因此它发送平均速度值。这个3字节的消息顺着MIDI电缆进入合成器的Midi In埠。通过播放中音C的音调来响应合成器。   
释放键时，键盘会将另一个3字节消息发送给MIDI Out端口：   
90 3C 00   
这与Note On命令相同，但带有0速字节。**这个字节值0表示Note Off命令**，意味着应该关闭音符。合成器通过停止声音来响应。    
如果合成器有复调音乐的能力（即，同时播放多个音符的能力），那么就可以在键盘上演奏和弦。键盘产生多条Note On消息，并且合成器将播放所有的音符。当释放和弦时，键盘就将多条Note Off消息发送给合成器。   
一般来说，这种设定中的键盘称为「MIDI控制器」，它负责产生MIDI消息来控制合成器。MIDI控制器看起来不像键盘。MIDI控制器包括下面几种：看起来像单簧管或萨克斯管的MID管乐控制器、MIDI吉他控制器、MIDI弦乐控制器和MIDI鼓控制器。至少所有这些控制器都产生3字节的Note On和Note Off消息。   
胜过类似的键盘或传统乐器，控制器也可以是「编曲器」，它是在内存中储存Note On和Note Off消息顺序，然后再播放的硬件。现在单机编曲器已经比几年前少见多了，因为它们已经被计算机所替代。安装MIDI卡的计算机也可以生成Note On和Note Off消息来控制合成器。MIDI编辑软件，允许您在屏幕上作曲，还可以储存来自MIDI控制器的MIDI消息，并处理这些消息，然后将MIDI消息发送给合成器。    
合成器有时也称为「声音模块（sound module）」或「音源器（tone generator）」。MIDI不指定如何真正产生这些声音的方法。合成器可以使用任何一种声音生成技术。     
实际上，只有非常简单的MIDI控制器（例如管乐控制器）才只有MIDI Out电缆埠。通常键盘都有内建合成器，并且有三个MIDI电缆端口，分别标记为「MIDI In」、「MIDI Out」和「MIDI Thru」。MIDI In端口接受MIDI消息，从而播放键盘的内部合成器。MIDI Out端口将MIDI消息从键盘发送到外部合成器。MIDI Thru埠是一个输出埠，它复制MIDI In端口的输入信号－无论从MIDI In埠获得什么都发送给MIDI Thru埠（MIDI Thru埠不包括从MIDI Out埠发送的任何信息）。    
透过电缆连结MIDI硬件只有两种方法：将一个硬件上的MIDI Out连结到另一个的MIDI In，或者将MIDI Thru与MIDI In连结。MIDI Thru端口允许连结一系列的MIDI合成器。    
### 程序更改
通常合成器能够生成的各种声音都储存在ROM或者其它地方。它们通常称为「声音」、「乐器」或者「音色」。（ 「音色」一词来自模拟合成器的时代，当时通过将音色和弦插入合成器前面的插孔中来设定不同的声音）。    
在MIDI中，合成器能够生成的各种声音称为「程序」。改变这个程序需要向合成器发送MIDI Program Change消息：    
C0 pp   
其中，pp的范围是0到127。通常MIDI键盘的顶部是一系列有限的按钮，这些按钮将产生Program Change消息。通过按下这些按钮可以从控制合成器的声音。这些按钮号通常由1开始，而不是由0开始，**因此程序句柄1与Program Change字节的0对应。**       
MIDI规格没有说明程序句柄与乐器的对应关系。例如，著名的Yamaha DX7合成器上的前三个程序分别称为「Warm Strings」、「 Mellow Horn」和「Pick Guitar」。而在Yamaha TX81Z音调发生器上，它们是Grand Piano、Upright Piano和Deep Grand。在Roland MT-32声音模块上，它们是Acoustic Piano 1、Acoustic Piano 2和Acoustic Piano 3。因此，如果不希望在从键盘制作程序改变时感到吃惊，那么最好了解一下乐器声与您将使用的合成器的程序句柄的对应关系。       
这对于包含Program Change消息的MIDI文件来说是一个实际问题－这些文件并不是设备无关的，因为它们的内容在不同的合成器上听起来是不一样的。然而，在最近几年，「General MIDI」（GM）标准已经把这些程序句柄标准化。Windows支援General MIDI。如果合成器与General MIDI规格不一致，那么程序转换可使它仿真General MIDI合成器。     
### MIDI通道

### MIDI消息
### MIDI编曲简介
参考BACHTOCC
### 通过键盘演奏MIDI合成器
参考KBMIDI
### MIDI击鼓器
参考DRUM
### 多媒体time函数
### RIFF文件I/O